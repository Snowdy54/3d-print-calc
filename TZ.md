# Техническое задание: 3D-Print Calculator

## 1. Цель проекта
Создание автоматизированной системы для расчета себестоимости и анализа рентабельности 3D-печати. Проект решает проблему учета изменчивость цен на расходные материалы (закупаемые в USD) и автоматизирует расчет сложной финансовой составляющей каждого заказа, включая износ оборудования и энергопотребление.

## 2. Роли пользователей
### Администратор (Суперпользователь) — "Владелец бизнеса"
* **Наполнение каталога**: Регистрация новых 3D-принтеров и добавление типов пластика в систему.
* **Финансовая настройка**: Установка тарифов на электроэнергию и выбор коэффициента наценки (через модель StudioSettings).
* **Контроль**: Полный доступ к панели управления Django Admin для корректировки любых данных.

### Менеджер (Авторизованный пользователь) — "Оператор"
* **Работа с заказами**: Создание расчетов на основе уже существующих принтеров и материалов, добавленных администратором.
* **Аналитика**: Просмотр готовых отчетов и графиков по эффективности работы студии.
* **Клиентский сервис**: Получение итоговой стоимости для передачи клиенту.

## 3. Схема данных (ER-диаграмма)
Проект базируется на 4 кастомных моделях, обеспечивающих полную прослеживаемость затрат.

**Связи:**
* `User` 1 --- N `Printer` (У каждого пользователя свой парк оборудования).
* `User` 1 --- N `Filament` (Индивидуальный каталог материалов).
* `Printer` 1 --- N `PrintOrder` (Принтер участвует во многих заказах).
* `Filament` 1 --- N `PrintOrder` (Пластик списывается в разных заказах).

## 4. Описание моделей данных
1.  **Printer (Принтер):** Название, энергопотребление (Вт), цена покупки.
2.  **Filament (Пластик):** Тип материала, цена за катушку (в USD для защиты от инфляции), вес нетто (г).
3.  **PrintOrder (Заказ):** Центральная сущность. Связывает принтер и пластик, хранит вес модели, время печати и вычисленную себестоимость.
4.  **StudioSettings:** Глобальные параметры (тариф на свет, коэффициент наценки).

## 5. Сценарии использования (Use Case Scenarios)

### UC-1: Регистрация ресурсов
Администратор через панель управления добавляет в систему доступные принтеры и катушки пластика. Система привязывает их к владельцу, формируя общую базу активов студии. Также Администратор задает глобальные параметры наценки и стоимости электроэнергии в модели StudioSettings, подготавливая среду для работы Менеджера.

### UC-2: Быстрый расчет себестоимости
1.  Менеджер выбирает принтер и пластик из выпадающего списка.
2.  Вводит параметры модели (вес и время).
3.  **Алгоритм:** Система запрашивает курс USD через API, вычисляет стоимость потраченного грамма пластика и прибавляет стоимость электроэнергии.
4.  Результат сохраняется в `total_cost`.

### UC-3: Анализ рентабельности
Пользователь открывает страницу аналитики. Система агрегирует данные через Django ORM (`Sum`, `Count`) и передает их в **Plotly** для визуализации распределения нагрузки на принтеры и расхода пластика.

## 6. Алгоритмы работы функций

### Алгоритм расчета `calculate_cost`:
Логика реализована внутри метода `save()` модели `PrintOrder`:
1.  **Курс:** Получение `usd_rate` через `requests.get` к API.
2.  **Материал:** `Cost_materials = (Filament.price_usd * usd_rate / Filament.weight_g) * Order.weight_g`
3.  **Электричество:** `Cost_electricity = (Printer.power / 1000) * Order.time * Settings.tariff`
4.  **Итог:** `total_cost = Cost_materials + Cost_electricity`.

## 7. Внешние интеграции и технологии
* **API:** ExchangeRate-API для получения валютных котировок в реальном времени.
* **Frontend Интерактив:** HTMX/AJAX для динамического обновления цены при вводе данных.
* **Визуализация:** Plotly (интерактивные Pie и Bar Charts).
* **Качество (QA):** Покрытие проекта 8 Unit-тестами для проверки математических вычислений и логики.
